Moved some function call results into variables instead of inside other function calls to aid debugging.-